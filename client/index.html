<!DOCTYPE html>
<html>
<!-- 测试 -->
<head>
    <meta charset="utf-8">
    <title>Achuan-2's Plugin</title>
    <style>
        :root {
            --bg: #1f1f1f;
            --bg-panel: #262626;
            --bg-panel-2: #2d2d2d;
            --text: #eaeaea;
            --muted: #b8b8b8;
            --primary: #4ea1ff;
            --primary-600: #3188ea;
            --border: #3a3a3a;
            --danger: #ff5c5c;
            --radius: 8px;
            --radius-sm: 6px;
            --spacing: 10px;
        }

        html,
        body {
            height: 100%;
            background: var(--bg);
            color: var(--text);
            font-family: Arial, sans-serif;
            font-size: 13px;
            margin: 0;
        }

        /* 让根容器在 CEP 面板内可自适应宽度与高度 */
        .app {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-width: 100px;
            /* 防止过窄挤压到不可用 */
        }

        /* 顶部标签栏：横向排布，可在狭窄面板时换行 */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            border-bottom: 1px solid var(--border);
            padding: 8px;
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 2;
        }

        .tab {
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            color: var(--muted);
            cursor: pointer;
            user-select: none;
            transition: all .15s ease;
            flex: 0 1 auto;
            /* 允许压缩 */
        }

        .tab:hover {
            background: var(--bg-panel);
            color: var(--text);
        }

        .tab.active {
            background: var(--primary);
            color: #0d1117;
        }

        /* 内容区：填满剩余空间并允许滚动 */
        .content {
            padding: 12px;
            overflow: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* 面板容器：使用 block 切换可见，但内部采用自适应布局 */
        .panel {
            display: none;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
        }

        .panel.active {
            display: block;
        }

        .panel h3 {
            margin: 0 0 10px;
            font-size: 14px;
            color: var(--text);
        }

        /* 表单区域改为响应式网格：根据宽度自动填充列 */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 10px 14px;
            align-items: start;
        }

        /* 输入行：标签与控件在宽时同排，窄时换行 */
        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            /* 允许在窄宽度时换行 */
        }

        label {
            color: var(--muted);
            flex-shrink: 0;
            /* 防止标签被压缩 */
            white-space: nowrap;
        }

        /* 为特定面板的标签设置宽度 */
        #panel-size .input-group>label {
            flex-basis: 75px;
        }

        /* 控件尽量占据剩余空间，避免固定像素宽度导致溢出 */
        input[type="number"],
        input[type="text"],
        select {
            flex: 1 1 100px;
            /* min-width: 80px; */
            padding: 6px 8px;
            background: var(--bg-panel-2);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: var(--radius-sm);
            outline: none;
            width: auto;
            /* 覆盖旧的固定宽度 */
        }

        input[type="checkbox"] {
            transform: scale(1.1);
        }

        /* 按钮区域：自动换行并留出间距 */
        .btn {
            padding: 8px 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-panel-2);
            color: var(--text);
            cursor: pointer;
            transition: all .15s ease;
            flex: 0 0 auto;
        }

        .btn:hover {
            filter: brightness(1.1);
        }

        .btn-primary {
            background: var(--primary);
            border-color: var(--primary-600);
            color: #0d1117;
        }

        .btn-danger {
            background: #3a2323;
            border-color: #5a2b2b;
            color: #ffcccc;
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        /* 小型辅助行：保持可换行 */
        .row {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
        }

        .spacer {
            height: 8px;
        }

        /* Label offset editing mode styles */
        .input-group input.editing-mode {
            border-color: var(--danger);
            background: rgba(255, 92, 92, 0.1);
            color: #ffcccc;
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="tabs" id="tabs">
            <div class="tab active" data-target="panel-relative" data-hash="relative">Relative Position</div>
            <div class="tab" data-target="panel-size" data-hash="size">Size Paste</div>
            <div class="tab" data-target="panel-arrange" data-hash="arrange">Arrange Images</div>
            <div class="tab" data-target="panel-swap" data-hash="swap">Swap</div>
            <div class="tab" data-target="panel-labels" data-hash="labels">Image Labels</div>
            <div class="tab" data-target="panel-about" data-hash="about">About</div>
        </div>
        <div class="content">
            <!-- Relative Position Panel -->
            <div class="panel active" id="panel-relative">
                <div class="grid">
                    <div class="input-group">
                        <label>ΔX (mm) [right:+,left:-]:</label>
                        <input type="text" id="delta-x" value="0">
                    </div>
                    <div class="input-group">
                        <label>ΔY (mm) [down:+,up:-]:</label>
                        <input type="text" id="delta-y" value="0">
                    </div>
                    <div class="input-group">
                        <label>Relative Corner:</label>
                        <select id="relative-corner" style="width:120px">
                            <option value="TL">Top-Left</option>
                            <option value="TR">Top-Right</option>
                            <option value="BL">Bottom-Left</option>
                            <option value="BR">Bottom-Right</option>
                        </select>
                    </div>

                    <!-- New: Order options for Relative Position -->
                    <div class="input-group">
                        <label>Order:</label>
                        <select id="relative-order">
                            <option value="stacking">stacking order</option>
                            <option value="horizontal">horizontal order</option>
                            <option value="vertical" selected>vertical order</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Reverse Order:</label>
                        <input type="checkbox" id="reverse-move-checkbox" title="Reverse order and move direction">
                    </div>
                    <div class="input-group">
                        <label>Force Paste on Mismatch</label>
                        <input type="checkbox" id="allow-mismatch-paste"
                            title="When counts mismatch, still paste using cyclic deltas">
                    </div>
                    <div class="input-group">
                        <label>Artboard Reference</label>
                        <input type="checkbox" id="use-artboard-ref"
                            title="Use current artboard as copy reference; paste using each shape's own artboard-relative position">
                    </div>
                </div>
                <div class="toolbar">
                    <button class="btn" id="copy-pos-button">Copy</button>
                    <button class="btn" id="paste-pos-button">Paste</button>
                </div>
            </div>

            <!-- Arrange Images Panel -->
            <div class="panel" id="panel-arrange">
                <div class="grid">
                    <div class="input-group">
                        <label>Columns:</label>
                        <input type="number" id="columns" value="1" min="1">
                    </div>
                    <div class="input-group">
                        <label>Row Gap (mm):</label>
                        <input type="number" id="row-gap" value="1" min="0">
                    </div>
                    <div class="input-group">
                        <label>Column Gap (mm):</label>
                        <input type="number" id="col-gap" value="1" min="0">
                    </div>
                    <div class="input-group">
                        <label>Resize Width (mm):</label>
                        <input type="number" id="uniform-width" value="100" min="0">
                        <input type="checkbox" id="use-uniform-width" title="Use Uniform Width">
                    </div>
                    <div class="input-group">
                        <label>Resize Height (mm):</label>
                        <input type="number" id="uniform-height" value="100" min="0">
                        <input type="checkbox" id="use-uniform-height" title="Use Uniform Height">
                    </div>

                    <!-- New: Order options for Arrange Images -->
                    <div class="input-group">
                        <label>Order:</label>
                        <select id="arrange-order">
                            <option value="stacking">stacking order</option>
                            <option value="horizontal">horizontal order</option>
                            <option value="vertical" selected>vertical order</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Reverse order</label>
                        <input type="checkbox" id="arrange-reverse-order" title="Reverse ordered list">
                    </div>
                </div>
                <div class="toolbar">
                    <button class="btn btn-primary" id="arrange-button">Arrange Images</button>
                </div>
            </div>

            <!-- Swap Panel -->
            <div class="panel" id="panel-swap">
                <div class="toolbar">
                    <button class="btn btn-primary" id="swap-button">Swap Positions</button>
                </div>
            </div>

            <!-- Image Labels Panel -->
            <div class="panel" id="panel-labels">
                <div class="grid">
                    <div class="input-group">
                        <label>Font Family:</label>
                        <input type="text" id="font-family" value="Arial">
                    </div>
                    <div class="input-group">
                        <label>Font Size(pt):</label>
                        <input type="number" id="font-size" value="6" min="1">
                    </div>
                    <div class="input-group">
                        <label>Offset X(pt):</label>
                        <input type="number" id="label-offset-x" value="-6" title="">
                    </div>
                    <div class="input-group">
                        <label>Offset Y(pt) :</label>
                        <input type="number" id="label-offset-y" value="-6" title="">
                    </div>
                    <div class="input-group">
                        <label>Label Template:</label>
                        <select id="label-template">
                            <option value="a">a</option>
                            <option value="A">A</option>
                            <option value="A)">A)</option>
                            <option value="a)">a)</option>
                        </select>
                    </div>

                    <!-- New: Start Count for Image Labels -->
                    <div class="input-group">
                        <label>Label Index</label>
                        <input type="number" id="label-start-count" value="1" min="1">
                        <button class="btn" id="undo-label-index" title="Undo to previous label index"
                            style="flex: 0 0 auto; padding: 6px 10px;">↶</button>
                    </div>

                    <!-- New: Order options for Image Labels -->
                    <div class="input-group">
                        <label>Order:</label>
                        <select id="labels-order">
                            <option value="stacking">stacking order</option>
                            <option value="horizontal">horizontal order</option>
                            <option value="vertical" selected>vertical order</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Reverse order</label>
                        <input type="checkbox" id="labels-reverse-order" title="Reverse ordered list">
                    </div>
                </div>
                <div class="toolbar">
                    <button class="btn btn-primary" id="add-label-button">Add Labels</button>
                </div>
            </div>
            <!-- Size Formater Panel -->
            <div class="panel" id="panel-size">
                <div class="grid">
                    <div class="input-group">
                        <label for="size-w">Width (mm):</label>
                        <input type="number" id="size-w" value="0" style="flex: 0 1 60px;">
                        <input type="checkbox" id="use-size-w" checked title="Use Width">
                    </div>
                    <div class="input-group">
                        <label for="size-h">Height (mm):</label>
                        <input type="number" id="size-h" value="0" style="flex: 0 1 60px;">
                        <input type="checkbox" id="use-size-h" checked title="Use Height">
                    </div>
                </div>
                <div class="toolbar">
                    <button class="btn" id="copy-size-button">Copy Size</button>
                    <button class="btn btn-primary" id="paste-size-button">Paste Size</button>
                </div>
            </div>
            <!-- About Panel -->
            <div class="panel" id="panel-about">
                <h3>About This Plugin</h3>
                <p>Author: Achuan-2</p>
                <p>GitHub: <a href="https://github.com/Achuan-2/illustrator_sci_plugin" target="_blank"
                        style="color: var(--primary); text-decoration: none;">https://github.com/Achuan-2/illustrator_sci_plugin</a>
                </p>
                <p>Like this plugin? Feel free to support my work with a donation.</p>
                <img src="../icons/donate.webp" width="80%">
            </div>
        </div>
    </div>

    <!-- Dependencies -->
    <script type="text/javascript" src="CSInterface.js" defer></script>
    <script type="text/javascript" src="../host/index.jsx" defer></script>
    <!-- Tabs logic: keep ids intact for existing scripts -->
    <script>
        (function () {
            const tabs = document.querySelectorAll('.tab');
            const panels = document.querySelectorAll('.panel');

            function activate(hash) {
                let target = 'panel-relative';
                if (hash === 'arrange') target = 'panel-arrange';
                else if (hash === 'labels') target = 'panel-labels';
                else if (hash === 'size') target = 'panel-size';
                else if (hash === 'swap') target = 'panel-swap';
                else if (hash === 'about') target = 'panel-about';

                tabs.forEach(t => t.classList.toggle('active', t.dataset.target === target));
                panels.forEach(p => p.classList.toggle('active', p.id === target));
            }

            function readHash() {
                const h = (location.hash || '').replace('#', '');
                if (h) activate(h);
            }

            tabs.forEach(t => {
                t.addEventListener('click', () => {
                    const hash = t.dataset.hash;
                    // update URL hash (non-breaking for CEP)
                    try { location.hash = hash; } catch (e) { }
                    activate(hash);
                });
            });

            window.addEventListener('hashchange', readHash);
            // init
            readHash();
        })();
    </script>
</body>

</html>